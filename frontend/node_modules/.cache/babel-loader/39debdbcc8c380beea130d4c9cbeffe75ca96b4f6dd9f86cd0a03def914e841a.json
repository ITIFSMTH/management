{"ast":null,"code":"import VueCookies from 'vue-cookies';\nimport jwtDecode from \"jwt-decode\";\nimport { createRouter, createWebHistory } from \"vue-router\";\nimport { Roles } from '@/shared';\nconst routes = [{\n  path: '/login',\n  name: 'login-route',\n  meta: {\n    layout: 'login-layout',\n    auth: false\n  },\n  component: () => import('@/views/Login.vue')\n}, {\n  path: '/admin',\n  name: 'admin-route',\n  meta: {\n    layout: 'panel-layout',\n    auth: true,\n    forRoles: [Roles.AdministratorRole]\n  },\n  component: () => import('@/views/Admin.vue')\n}, {\n  path: '/operator',\n  name: 'operator-route',\n  meta: {\n    layout: 'panel-layout',\n    auth: true,\n    forRoles: [Roles.JuniorOperatorRole, Roles.SeniorOperatorRole]\n  },\n  component: () => import('@/views/Operator.vue')\n}, {\n  path: '/operator/poll/rating',\n  name: 'rating-poll-route',\n  meta: {\n    layout: 'panel-layout',\n    auth: true,\n    forRoles: [Roles.JuniorOperatorRole]\n  },\n  component: () => import('@/views/Admin.vue')\n}, {\n  path: '/operator/poll/budget',\n  name: 'budget-poll-route',\n  meta: {\n    layout: 'panel-layout',\n    auth: true,\n    forRoles: [Roles.SeniorOperatorRole]\n  },\n  component: () => import('@/views/Admin.vue')\n}, {\n  path: '/:pathMatch(.*)*',\n  redirect: '/admin'\n}];\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\nrouter.beforeEach((to, from, next) => {\n  const jwtCookie = VueCookies.get('jwt');\n  const jwtDecoded = jwtCookie ? jwtDecode(jwtCookie) : {};\n  const requireAuth = to.matched.some(record => record.meta.auth);\n  const forAdmin = to.matched.some(record => record.meta.forAdmin);\n  if (requireAuth && !jwtCookie || requireAuth && Date.now() >= jwtDecoded.exp * 1000) {\n    return next({\n      name: 'login-route'\n    });\n  }\n  if (forAdmin && jwtDecoded.role_id != 1) {\n    // Redirect to page no admin role\n    //return next({name: 'login-route'})\n  }\n  if (!requireAuth && Date.now() < jwtDecoded.exp * 1000) return next({\n    name: 'admin-route'\n  });\n  next();\n});\nexport default router;","map":{"version":3,"names":["VueCookies","jwtDecode","createRouter","createWebHistory","Roles","routes","path","name","meta","layout","auth","component","forRoles","AdministratorRole","JuniorOperatorRole","SeniorOperatorRole","redirect","router","history","process","env","BASE_URL","beforeEach","to","from","next","jwtCookie","get","jwtDecoded","requireAuth","matched","some","record","forAdmin","Date","now","exp","role_id"],"sources":["/home/f48d1/Documents/work/orbita/management/frontend/src/router/index.js"],"sourcesContent":["import VueCookies from 'vue-cookies';\nimport jwtDecode from \"jwt-decode\";\nimport { createRouter, createWebHistory } from \"vue-router\";\nimport { Roles } from '@/shared';\n\n\nconst routes = [\n  {\n    path: '/login',\n    name: 'login-route',\n    meta: {layout: 'login-layout', auth: false},\n    component: () => import('@/views/Login.vue')\n  },\n  {\n    path: '/admin',\n    name: 'admin-route',\n    meta: {layout: 'panel-layout', auth: true, forRoles: [Roles.AdministratorRole]},\n    component: () => import('@/views/Admin.vue')\n  },\n  {\n    path: '/operator',\n    name: 'operator-route',\n    meta: {layout: 'panel-layout', auth: true, forRoles: [Roles.JuniorOperatorRole, Roles.SeniorOperatorRole]},\n    component: () => import('@/views/Operator.vue')\n  },\n  {\n    path: '/operator/poll/rating',\n    name: 'rating-poll-route',\n    meta: {layout: 'panel-layout', auth: true, forRoles: [Roles.JuniorOperatorRole]},\n    component: () => import('@/views/Admin.vue')\n  },\n  {\n    path: '/operator/poll/budget',\n    name: 'budget-poll-route',\n    meta: {layout: 'panel-layout', auth: true, forRoles: [Roles.SeniorOperatorRole]},\n    component: () => import('@/views/Admin.vue')\n  },\n  {\n    path: '/:pathMatch(.*)*',\n    redirect: '/admin'\n  }\n]\n\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes,\n});\n\nrouter.beforeEach((to, from, next) => {\n  const jwtCookie = VueCookies.get('jwt')\n  const jwtDecoded = jwtCookie ? jwtDecode(jwtCookie) : {}\n\n  const requireAuth = to.matched.some(record => record.meta.auth)\n  const forAdmin = to.matched.some(record => record.meta.forAdmin)\n  \n  if (\n    (requireAuth && !jwtCookie) || \n    (requireAuth && Date.now() >= jwtDecoded.exp * 1000)\n  ){\n    return next({name:'login-route'})\n  }\n\n  if (\n    forAdmin && jwtDecoded.role_id != 1\n  ) {\n    // Redirect to page no admin role\n    //return next({name: 'login-route'})\n  }\n  \n  if (\n    !requireAuth && Date.now() < jwtDecoded.exp * 1000\n  ) return next({name: 'admin-route'})\n\n  next()\n})\n\nexport default router"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}