{"ast":null,"code":"import VueCookies from 'vue-cookies';\nimport jwtDecode from \"jwt-decode\";\nimport { createRouter, createWebHistory } from \"vue-router\";\nimport { Roles } from '@/shared';\nconst routes = [{\n  path: '/login',\n  name: 'login-route',\n  meta: {\n    layout: 'login-layout'\n  },\n  component: () => import('@/views/Login.vue')\n}, {\n  path: '/admin',\n  name: 'admin-route',\n  meta: {\n    layout: 'panel-layout',\n    forRoles: [Roles.AdministratorRole]\n  },\n  component: () => import('@/views/Admin.vue')\n}, {\n  path: '/operator',\n  name: 'operator-route',\n  meta: {\n    layout: 'panel-layout',\n    forRoles: [Roles.JuniorOperatorRole, Roles.SeniorOperatorRole]\n  },\n  component: () => import('@/views/Operator.vue')\n}, {\n  path: '/operator/poll/rating',\n  name: 'rating-poll-route',\n  meta: {\n    layout: 'panel-layout',\n    forRoles: [Roles.JuniorOperatorRole]\n  },\n  component: () => import('@/views/Admin.vue')\n}, {\n  path: '/operator/poll/budget',\n  name: 'budget-poll-route',\n  meta: {\n    layout: 'panel-layout',\n    forRoles: [Roles.SeniorOperatorRole]\n  },\n  component: () => import('@/views/Admin.vue')\n}, {\n  path: '/:pathMatch(.*)*',\n  redirect: '/admin'\n}];\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\nrouter.beforeEach((to, from, next) => {\n  const jwtCookie = VueCookies.get('jwt');\n  const jwtDecoded = jwtCookie ? jwtDecode(jwtCookie) : {};\n  const requireAuth = to.matched.some(record => record.meta.auth);\n  const forAdmin = to.matched.some(record => record.meta.forAdmin);\n  if (requireAuth && !jwtCookie || requireAuth && Date.now() >= jwtDecoded.exp * 1000) {\n    return next({\n      name: 'login-route'\n    });\n  }\n  if (forAdmin && jwtDecoded.role_id != 1) {\n    // Redirect to page no admin role\n    //return next({name: 'login-route'})\n  }\n  if (!requireAuth && Date.now() < jwtDecoded.exp * 1000) return next({\n    name: 'admin-route'\n  });\n  next();\n});\nexport default router;","map":{"version":3,"names":["VueCookies","jwtDecode","createRouter","createWebHistory","Roles","routes","path","name","meta","layout","component","forRoles","AdministratorRole","JuniorOperatorRole","SeniorOperatorRole","redirect","router","history","process","env","BASE_URL","beforeEach","to","from","next","jwtCookie","get","jwtDecoded","requireAuth","matched","some","record","auth","forAdmin","Date","now","exp","role_id"],"sources":["/home/f48d1/Documents/work/orbita/management/frontend/src/router/index.js"],"sourcesContent":["import VueCookies from 'vue-cookies';\nimport jwtDecode from \"jwt-decode\";\nimport { createRouter, createWebHistory } from \"vue-router\";\nimport { Roles } from '@/shared';\n\n\nconst routes = [\n  {\n    path: '/login',\n    name: 'login-route',\n    meta: {layout: 'login-layout'},\n    component: () => import('@/views/Login.vue')\n  },\n  {\n    path: '/admin',\n    name: 'admin-route',\n    meta: {layout: 'panel-layout', forRoles: [Roles.AdministratorRole]},\n    component: () => import('@/views/Admin.vue')\n  },\n  {\n    path: '/operator',\n    name: 'operator-route',\n    meta: {layout: 'panel-layout', forRoles: [Roles.JuniorOperatorRole, Roles.SeniorOperatorRole]},\n    component: () => import('@/views/Operator.vue')\n  },\n  {\n    path: '/operator/poll/rating',\n    name: 'rating-poll-route',\n    meta: {layout: 'panel-layout', forRoles: [Roles.JuniorOperatorRole]},\n    component: () => import('@/views/Admin.vue')\n  },\n  {\n    path: '/operator/poll/budget',\n    name: 'budget-poll-route',\n    meta: {layout: 'panel-layout', forRoles: [Roles.SeniorOperatorRole]},\n    component: () => import('@/views/Admin.vue')\n  },\n  {\n    path: '/:pathMatch(.*)*',\n    redirect: '/admin'\n  }\n]\n\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes,\n});\n\nrouter.beforeEach((to, from, next) => {\n  const jwtCookie = VueCookies.get('jwt')\n  const jwtDecoded = jwtCookie ? jwtDecode(jwtCookie) : {}\n\n  const requireAuth = to.matched.some(record => record.meta.auth)\n  const forAdmin = to.matched.some(record => record.meta.forAdmin)\n  \n  if (\n    (requireAuth && !jwtCookie) || \n    (requireAuth && Date.now() >= jwtDecoded.exp * 1000)\n  ){\n    return next({name:'login-route'})\n  }\n\n  if (\n    forAdmin && jwtDecoded.role_id != 1\n  ) {\n    // Redirect to page no admin role\n    //return next({name: 'login-route'})\n  }\n  \n  if (\n    !requireAuth && Date.now() < jwtDecoded.exp * 1000\n  ) return next({name: 'admin-route'})\n\n  next()\n})\n\nexport default router"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}