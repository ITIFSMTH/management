{"ast":null,"code":"import VueCookies from 'vue-cookies';\nimport jwtDecode from \"jwt-decode\";\nimport { createRouter, createWebHistory } from \"vue-router\";\nimport { Roles } from '@/shared';\nconst routes = [{\n  path: '/login',\n  name: 'login-route',\n  meta: {\n    layout: 'login-layout',\n    auth: false\n  },\n  component: () => import('@/views/Login.vue')\n}, {\n  path: '/admin',\n  name: 'admin-route',\n  meta: {\n    layout: 'panel-layout',\n    auth: true,\n    forAdmin: true\n  },\n  component: () => import('@/views/Admin.vue')\n}, {\n  path: '/operator',\n  name: 'operator-route',\n  meta: {\n    layout: 'panel-layout',\n    auth: true,\n    forOperators: true\n  },\n  component: () => import('@/views/Operator.vue')\n}, {\n  path: '/operator/poll/rating',\n  name: 'rating-poll-route',\n  meta: {\n    layout: 'panel-layout',\n    auth: true,\n    forAdmin: true\n  },\n  component: () => import('@/views/Admin.vue')\n}, {\n  path: '/operator/poll/budget',\n  name: 'budget-poll-route',\n  meta: {\n    layout: 'panel-layout',\n    auth: true,\n    forAdmin: true\n  },\n  component: () => import('@/views/Admin.vue')\n}, {\n  path: '/:pathMatch(.*)*',\n  redirect: '/admin'\n}];\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\nrouter.beforeEach((to, from, next) => {\n  const jwtCookie = VueCookies.get('jwt');\n  const jwtDecoded = jwtCookie ? jwtDecode(jwtCookie) : {};\n  const requireAuth = to.matched.some(record => record.meta.auth);\n  const forAdmin = to.matched.some(record => record.meta.forAdmin);\n  if (requireAuth && !jwtCookie || requireAuth && Date.now() >= jwtDecoded.exp * 1000) {\n    return next({\n      name: 'login-route'\n    });\n  }\n  if (forAdmin && jwtDecoded.role_id != 1) {\n    // Redirect to page no admin role\n    //return next({name: 'login-route'})\n  }\n  if (!requireAuth && Date.now() < jwtDecoded.exp * 1000) return next({\n    name: 'admin-route'\n  });\n  next();\n});\nexport default router;","map":{"version":3,"names":["VueCookies","jwtDecode","createRouter","createWebHistory","Roles","routes","path","name","meta","layout","auth","component","forAdmin","forOperators","redirect","router","history","process","env","BASE_URL","beforeEach","to","from","next","jwtCookie","get","jwtDecoded","requireAuth","matched","some","record","Date","now","exp","role_id"],"sources":["/home/f48d1/Documents/work/orbita/management/frontend/src/router/index.js"],"sourcesContent":["import VueCookies from 'vue-cookies';\nimport jwtDecode from \"jwt-decode\";\nimport { createRouter, createWebHistory } from \"vue-router\";\nimport { Roles } from '@/shared';\n\n\nconst routes = [\n  {\n    path: '/login',\n    name: 'login-route',\n    meta: {layout: 'login-layout', auth: false},\n    component: () => import('@/views/Login.vue')\n  },\n  {\n    path: '/admin',\n    name: 'admin-route',\n    meta: {layout: 'panel-layout', auth: true, forAdmin: true},\n    component: () => import('@/views/Admin.vue')\n  },\n  {\n    path: '/operator',\n    name: 'operator-route',\n    meta: {layout: 'panel-layout', auth: true, forOperators: true},\n    component: () => import('@/views/Operator.vue')\n  },\n  {\n    path: '/operator/poll/rating',\n    name: 'rating-poll-route',\n    meta: {layout: 'panel-layout', auth: true, forAdmin: true},\n    component: () => import('@/views/Admin.vue')\n  },\n  {\n    path: '/operator/poll/budget',\n    name: 'budget-poll-route',\n    meta: {layout: 'panel-layout', auth: true, forAdmin: true},\n    component: () => import('@/views/Admin.vue')\n  },\n  {\n    path: '/:pathMatch(.*)*',\n    redirect: '/admin'\n  }\n]\n\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes,\n});\n\nrouter.beforeEach((to, from, next) => {\n  const jwtCookie = VueCookies.get('jwt')\n  const jwtDecoded = jwtCookie ? jwtDecode(jwtCookie) : {}\n\n  const requireAuth = to.matched.some(record => record.meta.auth)\n  const forAdmin = to.matched.some(record => record.meta.forAdmin)\n  \n  if (\n    (requireAuth && !jwtCookie) || \n    (requireAuth && Date.now() >= jwtDecoded.exp * 1000)\n  ){\n    return next({name:'login-route'})\n  }\n\n  if (\n    forAdmin && jwtDecoded.role_id != 1\n  ) {\n    // Redirect to page no admin role\n    //return next({name: 'login-route'})\n  }\n  \n  if (\n    !requireAuth && Date.now() < jwtDecoded.exp * 1000\n  ) return next({name: 'admin-route'})\n\n  next()\n})\n\nexport default router"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}